# Multi-Event Platform Architecture

## ğŸ¯ System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        USER JOURNEY                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. User visits: https://sports-tickets.vercel.app/events
2. Browses 3 concurrent events
3. Selects event â†’ Chooses tickets â†’ Enters email
4. Clicks "Complete Purchase" â†’ Redirects to Stripe Checkout
5. Completes payment â†’ Redirects to Success page
6. Receives email(s) with QR code(s) within 60 seconds
7. Shows QR at venue â†’ Staff scans â†’ Entry granted
```

---

## ğŸ—ï¸ Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           VERCEL HOSTING                              â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    FRONTEND (React SPA)                      â”‚   â”‚
â”‚  â”‚                                                               â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚   â”‚
â”‚  â”‚  â”‚   Event 1    â”‚  â”‚   Event 2    â”‚  â”‚   Event 3    â”‚      â”‚   â”‚
â”‚  â”‚  â”‚   Gameday    â”‚  â”‚  Sportsplex  â”‚  â”‚  Sportsplex  â”‚      â”‚   â”‚
â”‚  â”‚  â”‚   Empire     â”‚  â”‚  Showdown    â”‚  â”‚    Event     â”‚      â”‚   â”‚
â”‚  â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚      â”‚   â”‚
â”‚  â”‚  â”‚ Admission +  â”‚  â”‚  Parking     â”‚  â”‚  Admission   â”‚      â”‚   â”‚
â”‚  â”‚  â”‚  Parking     â”‚  â”‚    ONLY      â”‚  â”‚    ONLY      â”‚      â”‚   â”‚
â”‚  â”‚  â”‚  $15 + $15   â”‚  â”‚    $15       â”‚  â”‚    $15       â”‚      â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚   â”‚
â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚   â”‚
â”‚  â”‚                            â”‚                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                               â”‚                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                  API ROUTES (Serverless)                      â”‚   â”‚
â”‚  â”‚                                                               â”‚   â”‚
â”‚  â”‚  /api/create-checkout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Maps eventId â†’ Price IDs   â”‚   â”‚
â”‚  â”‚  /api/stripe-webhook â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Processes completed orders â”‚   â”‚
â”‚  â”‚  /api/process-email-queue â”€â”€â”€â”€â”€â”€â–º Sends QR codes via email   â”‚   â”‚
â”‚  â”‚  /api/validate-ticket â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Validates QR scans         â”‚   â”‚
â”‚  â”‚  /api/scan-ticket â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Marks tickets as used      â”‚   â”‚
â”‚  â”‚                                                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â”‚ HTTP Requests
                               â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                  â”‚                  â”‚
            â–¼                  â–¼                  â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚    STRIPE    â”‚   â”‚   SUPABASE   â”‚   â”‚    RESEND    â”‚
    â”‚              â”‚   â”‚              â”‚   â”‚              â”‚
    â”‚  â€¢ Products  â”‚   â”‚  â€¢ tickets   â”‚   â”‚  â€¢ Email     â”‚
    â”‚  â€¢ Prices    â”‚   â”‚  â€¢ email_    â”‚   â”‚    Delivery  â”‚
    â”‚  â€¢ Checkout  â”‚   â”‚    queue     â”‚   â”‚  â€¢ QR Code   â”‚
    â”‚  â€¢ Webhooks  â”‚   â”‚  â€¢ scans     â”‚   â”‚    Attach    â”‚
    â”‚              â”‚   â”‚              â”‚   â”‚              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Event Configuration Matrix

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        EVENT COMPARISON                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Attribute    â”‚   Event 1    â”‚   Event 2    â”‚      Event 3          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Event Name   â”‚ Gameday      â”‚ Sportsplex   â”‚ Sportsplex Event      â”‚
â”‚              â”‚ Empire       â”‚ Showdown     â”‚                       â”‚
â”‚              â”‚ Showcase     â”‚              â”‚                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Event ID     â”‚ 1            â”‚ 2            â”‚ 3                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Category     â”‚ Basketball   â”‚ Sports       â”‚ Sports                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Date         â”‚ Dec 28       â”‚ Jan 5        â”‚ Jan 11                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Venue        â”‚ Downtown     â”‚ Sportsplex   â”‚ Sportsplex Center     â”‚
â”‚              â”‚ Arena        â”‚ Center       â”‚                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Has          â”‚ âœ… YES       â”‚ âŒ NO        â”‚ âœ… YES                â”‚
â”‚ Admission?   â”‚              â”‚              â”‚                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Admission    â”‚ $15          â”‚ N/A          â”‚ $15                   â”‚
â”‚ Price        â”‚              â”‚              â”‚                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Has          â”‚ âœ… YES       â”‚ âœ… YES       â”‚ âŒ NO                 â”‚
â”‚ Parking?     â”‚              â”‚              â”‚                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Parking      â”‚ $15          â”‚ $15          â”‚ N/A                   â”‚
â”‚ Price        â”‚              â”‚              â”‚                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Stripe       â”‚ GA_PRICE_ID  â”‚ N/A          â”‚ SPORTSPLEX_EVENT_     â”‚
â”‚ Admission    â”‚              â”‚              â”‚ ADMISSION_PRICE_ID    â”‚
â”‚ Price ID     â”‚              â”‚              â”‚                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Stripe       â”‚ PARKING_     â”‚ SPORTSPLEX_  â”‚ N/A                   â”‚
â”‚ Parking      â”‚ PRICE_ID     â”‚ SHOWDOWN_    â”‚                       â”‚
â”‚ Price ID     â”‚              â”‚ PARKING_     â”‚                       â”‚
â”‚              â”‚              â”‚ PRICE_ID     â”‚                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Example      â”‚ $30          â”‚ $15          â”‚ $15                   â”‚
â”‚ Order        â”‚ (1 admission â”‚ (1 parking)  â”‚ (1 admission)         â”‚
â”‚              â”‚ + 1 parking) â”‚              â”‚                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Checkout Flow (Per Event)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    STRIPE CHECKOUT SESSION                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 1: User clicks "Complete Purchase"
   â”‚
   â”œâ”€â–º POST /api/create-checkout
   â”‚   Body: { name, email, eventId, admissionQuantity, parkingQuantity }
   â”‚
   â””â”€â–º Backend maps eventId to correct Stripe Price IDs
       â”‚
       â”œâ”€â–º Event 1: Uses GA_PRICE_ID + PARKING_PRICE_ID
       â”œâ”€â–º Event 2: Uses SPORTSPLEX_SHOWDOWN_PARKING_PRICE_ID only
       â””â”€â–º Event 3: Uses SPORTSPLEX_EVENT_ADMISSION_PRICE_ID only

Step 2: Create Stripe Checkout Session
   â”‚
   â”œâ”€â–º Metadata: { buyerName, buyerEmail, eventId, quantities }
   â”œâ”€â–º Line Items: Array of { price, quantity }
   â”œâ”€â–º Success URL: /success?session_id={CHECKOUT_SESSION_ID}
   â””â”€â–º Cancel URL: /cancel

Step 3: User redirected to Stripe hosted checkout page
   â”‚
   â””â”€â–º Completes payment with card

Step 4: Stripe fires webhook: checkout.session.completed
   â”‚
   â””â”€â–º POST /api/stripe-webhook
       â”‚
       â”œâ”€â–º Verify signature
       â”œâ”€â–º Extract metadata & line items
       â”œâ”€â–º Generate unique ticket IDs
       â”œâ”€â–º Insert into Supabase:
       â”‚   â”œâ”€â–º tickets table (status: active)
       â”‚   â””â”€â–º email_queue table (status: pending)
       â”‚
       â””â”€â–º Return 200 OK to Stripe

Step 5: Cron job processes email queue (runs every minute)
   â”‚
   â””â”€â–º GET /api/process-email-queue
       â”‚
       â”œâ”€â–º Fetch pending emails from Supabase
       â”œâ”€â–º For each ticket:
       â”‚   â”œâ”€â–º Generate QR code (PNG image)
       â”‚   â”œâ”€â–º Upload to Supabase Storage
       â”‚   â”œâ”€â–º Send email via Resend with QR attachment
       â”‚   â””â”€â–º Update status: pending â†’ sent
       â”‚
       â””â”€â–º User receives email within 60 seconds

Step 6: User receives QR code email
   â”‚
   â””â”€â–º Contains:
       â”œâ”€â–º Event name & details
       â”œâ”€â–º Ticket type (Admission or Parking)
       â”œâ”€â–º QR code image (attached)
       â””â”€â–º Validation link: /validate?ticket_id=XXX
```

---

## ğŸ« Ticket Validation Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        QR CODE SCANNING                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Staff opens: https://sports-tickets.vercel.app/scan

   â”‚
   â”œâ”€â–º Camera permission requested
   â”‚
   â””â”€â–º QR scanner active

Fan shows QR code
   â”‚
   â”œâ”€â–º Scanner reads ticket_id from QR
   â”‚
   â””â”€â–º GET /api/validate-ticket?ticket_id=XXX
       â”‚
       â”œâ”€â–º Query Supabase tickets table
       â”‚
       â”œâ”€â–º Check ticket exists & status
       â”‚
       â””â”€â–º Return response:
           â”‚
           â”œâ”€â–º âœ… Valid (status: active)
           â”‚   Display: "Valid - Not Used"
           â”‚   Shows: Event name, type, buyer name
           â”‚
           â”œâ”€â–º âŒ Already Used (status: used)
           â”‚   Display: "Already Scanned"
           â”‚   Shows: First scan timestamp
           â”‚
           â””â”€â–º âŒ Invalid
               Display: "Ticket Not Found"

Staff clicks "Mark as Used"
   â”‚
   â””â”€â–º POST /api/scan-ticket
       Body: { ticket_id }
       â”‚
       â”œâ”€â–º Update tickets table: status â†’ used
       â”œâ”€â–º Insert scan record with timestamp
       â”‚
       â””â”€â–º Return success
           â”‚
           â””â”€â–º Scanner shows: "âœ… Ticket Accepted"
```

---

## ğŸ—„ï¸ Database Schema

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        SUPABASE TABLES                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

tickets (Main ticket records)
â”œâ”€ id (uuid, primary key)
â”œâ”€ stripe_session_id (text) â”€â”€â”€â–º Links to Stripe checkout
â”œâ”€ ticket_id (text, unique) â”€â”€â”€â–º QR code payload
â”œâ”€ event_id (text) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º "1", "2", or "3"
â”œâ”€ ticket_type (text) â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º "General Admission" or "Parking Pass"
â”œâ”€ buyer_name (text)
â”œâ”€ buyer_email (text)
â”œâ”€ status (text) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º "active" or "used"
â”œâ”€ qr_url (text) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Public URL to QR image
â”œâ”€ created_at (timestamp)
â””â”€ updated_at (timestamp)

email_queue (Async email processing)
â”œâ”€ id (uuid, primary key)
â”œâ”€ ticket_id (text) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º References tickets.ticket_id
â”œâ”€ recipient_email (text)
â”œâ”€ recipient_name (text)
â”œâ”€ ticket_type (text)
â”œâ”€ event_id (text)
â”œâ”€ status (text) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º "pending", "sent", or "failed"
â”œâ”€ retry_count (integer)
â”œâ”€ created_at (timestamp)
â””â”€ sent_at (timestamp)

scans (Scan history)
â”œâ”€ id (uuid, primary key)
â”œâ”€ ticket_id (text) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º References tickets.ticket_id
â”œâ”€ scanned_at (timestamp)
â”œâ”€ scanned_by (text)
â””â”€ location (text)
```

---

## ğŸ” Environment Variables Required

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      VERCEL ENVIRONMENT                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STRIPE (Payment Processing)
â”œâ”€ STRIPE_SECRET_KEY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º sk_live_... or sk_test_...
â””â”€ STRIPE_WEBHOOK_SECRET â”€â”€â”€â”€â”€â”€â–º whsec_... (from webhook endpoint)

STRIPE PRICE IDS (Product Mapping)
â”œâ”€ GA_PRICE_ID â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Event 1 Admission
â”œâ”€ PARKING_PRICE_ID â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Event 1 Parking
â”œâ”€ SPORTSPLEX_SHOWDOWN_PARKING_PRICE_ID â–º Event 2 Parking
â””â”€ SPORTSPLEX_EVENT_ADMISSION_PRICE_ID â”€â”€â–º Event 3 Admission

SUPABASE (Database)
â”œâ”€ SUPABASE_URL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º https://xxx.supabase.co
â””â”€ SUPABASE_SERVICE_ROLE_KEY â”€â”€â–º eyJhbGc...

RESEND (Email Delivery)
â””â”€ RESEND_API_KEY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º re_...

CRON (Background Jobs)
â””â”€ CRON_SECRET â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Random secure string
```

---

## ğŸ“ˆ Monitoring & Observability

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     PRODUCTION MONITORING                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Vercel Dashboard
â”œâ”€ Deployments â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Track deployment history
â”œâ”€ Functions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Monitor API response times
â”œâ”€ Logs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Real-time function logs
â””â”€ Analytics â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Page views, performance

Stripe Dashboard
â”œâ”€ Payments â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Track all transactions
â”œâ”€ Webhooks â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Monitor webhook deliveries
â”‚  â””â”€ Success rate should be 100%
â””â”€ Events â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º View raw event data

Supabase Dashboard
â”œâ”€ Table Editor â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º View tickets & email queue
â”œâ”€ SQL Editor â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Run queries for analytics
â”‚  Example: SELECT event_id, COUNT(*) FROM tickets GROUP BY event_id
â””â”€ Logs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Database activity logs

Resend Dashboard
â”œâ”€ Emails â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Track email deliveries
â”œâ”€ Logs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Delivery status & errors
â””â”€ Analytics â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Open rates, click rates
```

---

## ğŸš€ Performance Expectations

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        PERFORMANCE METRICS                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Checkout Flow
â”œâ”€ Stripe redirect â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º < 1 second
â”œâ”€ Payment processing â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º 2-3 seconds
â””â”€ Webhook receipt â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º < 2 seconds

Email Delivery
â”œâ”€ Webhook â†’ Database insert â”€â”€â–º < 2 seconds
â”œâ”€ Cron pickup â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º < 60 seconds (runs every minute)
â”œâ”€ QR generation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º < 1 second per ticket
â””â”€ Email delivery â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º < 5 seconds (via Resend)

Total time from payment to email: ~60-90 seconds

QR Code Validation
â”œâ”€ Camera initialization â”€â”€â”€â”€â”€â”€â–º < 1 second
â”œâ”€ QR scan â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Instant
â”œâ”€ API validation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º < 500ms
â””â”€ Status update â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º < 500ms
```

---

**Architecture Version:** 2.0
**Last Updated:** December 18, 2025
**Platform Status:** Production Ready

